<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

<h2>AI Article Generator Adsense</h2>
<p id="errorMessage" style="color:red;"></p>
<form id="myForm">
  <label for="apikey">API Key:</label><br>
  <input type="text" id="apikey" name="apikey" placeholder="Enter your API Key here" onchange="checkAPIKey()"><br>
  <label for="model">Model:</label><br>
  <select id="model" name="model">
    <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
    <option value="gpt-4">gpt-4</option>
  </select><br>
  <label for="maxtoken">Max Token:</label><br>
  <input type="number" id="maxtoken" name="maxtoken" value="7000" placeholder="Enter the maximum token count"><br>
  <label for="titleMaxToken">Title Max Token:</label><br>
  <input type="number" id="titleMaxToken" name="titleMaxToken" value="20" placeholder="Enter the maximum token count for title"><br>
  <label for="subheadingMaxToken">Subheading Max Token:</label><br>
  <input type="number" id="subheadingMaxToken" name="subheadingMaxToken" value="1000" placeholder="Enter the maximum token count for subheading"><br>
  <label for="myFile">Upload a TXT file:</label><br>
  <input type="file" id="myFile" name="filename"><br>
  <label for="myText">Or paste your text here:</label><br>
  <textarea id="myText" rows="4" cols="50" placeholder="Paste your text here"></textarea><br>
  <label for="titlePrompt">Title Prompt:</label><br>
  <input type="text" id="titlePrompt" name="titlePrompt" value="tulis ulang topik ini menjadi judul artikel yang menarik: "><br>
  <input type="submit" value="Submit">
</form>

<div id="fileContent">
</div>

<button id="aiTitle">AI Title</button>
<button id="aiHeading">AI Heading</button>

<p id="counter">Total Articles: 0</p>
<p id="tokenCounter">Total Tokens: 0</p>

<script>
let articleCount = 0;
let tokenCount = 0;
let input, textarea, fileContent;

function checkAPIKey() {
  var apikey = document.getElementById("apikey").value;
  fetch('https://api.openai.com/v1/engines/davinci', {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + apikey
    }
  })
  .then(response => {
    if (!response.ok) {
      throw new Error('Invalid API Key');
    }
    document.getElementById("errorMessage").innerText = ''; // Clear any previous error message
  })
  .catch(error => {
    console.error('Error:', error);
    document.getElementById("errorMessage").innerText = error.message; // Display the error message on the webpage
  });
}

document.getElementById("myForm").addEventListener("submit", function(event){
  event.preventDefault();
  var apikey = document.getElementById("apikey").value;
  var model = document.getElementById("model").value;
  var maxtoken = document.getElementById("maxtoken").value;
  document.cookie = "apikey=" + apikey + "; SameSite=None; Secure";
  
  var file = document.getElementById("myFile").files[0];
  var text = document.getElementById("myText").value;
  var reader = new FileReader();
  reader.onload = function(e) {
    var lines = e.target.result.split('\n');
    fileContent = document.getElementById("fileContent");
    fileContent.innerHTML = '';
    for(var i = 0; i < lines.length; i++){
      if(!lines[i].startsWith(' ') && lines[i].trim() !== ''){
        input = document.createElement("input");
        input.type = "text";
        input.className = "title";
        input.id = "title" + articleCount;
        input.value = lines[i];
        input.name = lines[i];
        fileContent.appendChild(input);
        textarea = document.createElement("textarea");
        textarea.rows = "4";
        textarea.cols = "50";
        textarea.className = "subheading";
        textarea.id = "subheading" + articleCount;
        fileContent.appendChild(textarea);
        articleCount++;
        tokenCount += lines[i].split(' ').length;
      } else if(lines[i].trim() !== ''){
        textarea.value += '\n' + lines[i].trim();
        tokenCount += lines[i].split(' ').length;
      }
    }
    document.getElementById("counter").innerText = "Total Articles: " + articleCount;
    document.getElementById("tokenCounter").innerText = "Total Tokens: " + tokenCount;
  };
  if(file) reader.readAsText(file);

  var textLines = text.split('\n');
  for(var i = 0; i < textLines.length; i++){
    if(!textLines[i].startsWith(' ') && textLines[i].trim() !== ''){
      input = document.createElement("input");
      input.type = "text";
      input.className = "title";
      input.id = "title" + articleCount;
      input.value = textLines[i];
      input.name = textLines[i];
      document.getElementById("fileContent").appendChild(input);
      textarea = document.createElement("textarea");
      textarea.rows = "4";
      textarea.cols = "50";
      textarea.className = "subheading";
      textarea.id = "subheading" + articleCount;
      document.getElementById("fileContent").appendChild(textarea);
      articleCount++;
      tokenCount += textLines[i].split(' ').length;
    } else if(textLines[i].trim() !== ''){
      textarea.value += '\n' + textLines[i].trim();
      tokenCount += textLines[i].split(' ').length;
    }
  }
  document.getElementById("counter").innerText = "Total Articles: " + articleCount;
  document.getElementById("tokenCounter").innerText = "Total Tokens: " + tokenCount;
});

document.getElementById("aiTitle").addEventListener("click", function() {
  var apikey = document.getElementById("apikey").value;
  var model = document.getElementById("model").value;
  var titleMaxToken = document.getElementById("titleMaxToken").value;
  var titlePrompt = document.getElementById("titlePrompt").value;
  var title;
  for(var i = 0; i < articleCount; i++){
    title = document.getElementById("title" + i).value;
    fetch('https://api.openai.com/v1/engines/' + model + '/completions', {
      method: 'POST',
      headers: {
        'Authorization': 'Bearer ' + apikey,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        prompt: titlePrompt + title,
        max_tokens: titleMaxToken
      })
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      return response.json();
    })
    .then(data => {
      if (data.choices && data.choices[0]) {
        document.getElementById("title" + i).value = data.choices[0].text.trim();
        document.getElementById("errorMessage").innerText = ''; // Clear any previous error message
      } else {
        throw new Error('Error: data.choices is undefined');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById("errorMessage").innerText = error.message; // Display the error message on the webpage
    });
  }
});

document.getElementById("aiHeading").addEventListener("click", function() {
  console.log("Generating subheadings...");
});
</script>

</body>
</html>
