<!DOCTYPE html>
<html>
<head>
    <title>Google Sheets Parser</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
    <style>
        textarea {
            width: 48%;
            height: 200px;
            float: left;
            margin-right: 1%;
        }
        #controls {
            width: 100%;
            align-items: flex-end;
        }

        #controls div {
            display: flex;
            flex-direction: column;
            margin-right: 10px;
        }

        #outputColumn, #promptColumn {
            width: 100%;
            margin-top: 5px;
        }

        #showContent {
            width: auto;
            max-height: fit-content;
        }

        #outputContent, #promptContent {
            width: 100%;
            height: 200px;
            border: 1px solid #ccc;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>Google Sheets Generator ver 1.058</h1>
    <input type="text" id="sheetUrl" placeholder="Public Google Sheet URL">
    <input type="text" id="sheetName" placeholder="Sheet Name">
    <button onclick="parseSheet()">Get</button>
    <p id="loading" style="display: none;">Loading...</p>
    <div id="controls" style="display: none;">
        <div>
            <label for="outputColumn" id="outputLabel">Output Column:</label>
            <select id="outputColumn"></select>
        </div>
        <div>
            <label for="promptColumn" id="promptLabel">Prompt Column:</label>
            <select id="promptColumn"></select>
        </div>
        <button id="showContent" onclick="showContent()">ðŸ‘€ Content</button>
    </div>
    <div id="outputContent" style="display: none;"></div>
    <div id="promptContent" style="display: none;"></div>

    <script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>

    <script>
        var lines = [];
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: 'AIzaSyD1fPFIgLPU6uHuM3TLMN4UP0VHIcQLuWo',
                discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
            });
        }

        function parseSheet() {
            var url = document.getElementById('sheetUrl').value;
            var sheetName = document.getElementById('sheetName').value;
            var urlRegex = /^https:\/\/docs\.google\.com\/spreadsheets\/d\/(.+)\/edit#gid=(.+)$/;

            if (!urlRegex.test(url)) {
                alert('Invalid URL. The correct format is: https://docs.google.com/spreadsheets/d/{sheetId}/edit#gid={gid}');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            var sheetId = url.split('/')[5];
            var gid = url.split('gid=')[1];

            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: sheetId,
                range: sheetName + '!A1:Z' // Adjust the range as needed
            }).then(function(response) {
                var range = response.result;
                if (range.values.length > 0) {
                    lines = range.values;
                    var columnTitles = lines[0];

                    var outputSelect = document.getElementById('outputColumn');
                    var promptSelect = document.getElementById('promptColumn');
                    outputSelect.innerHTML = "";
                    promptSelect.innerHTML = "";

                    for(var j = 0; j < columnTitles.length; j++) {
                        var option1 = document.createElement('option');
                        var option2 = document.createElement('option');
                        option1.text = columnTitles[j];
                        option2.text = columnTitles[j];
                        outputSelect.add(option1);
                        promptSelect.add(option2);
                    }
                    document.getElementById('controls').style.display = 'flex';
                    document.getElementById('loading').style.display = 'none';
                } else {
                    console.log('No data found.');
                }
            }, function(response) {
                console.error('Error: ' + response.result.error.message);
            });
        }

        function showContent() {
            var outputSelect = document.getElementById('outputColumn');
            var promptSelect = document.getElementById('promptColumn');
            var outputIndex = outputSelect.selectedIndex;
            var promptIndex = promptSelect.selectedIndex;
            var outputContent = "";
            var promptContent = "";

            for(var i = 1; i < lines.length; i++) {
                outputContent += "<p>" + lines[i][outputIndex] + "</p><hr>";
                promptContent += "<p>" + lines[i][promptIndex] + "</p><hr>";
            }

            document.getElementById('outputContent').style.display = "block";
            document.getElementById('promptContent').style.display = "block";
            document.getElementById('outputContent').innerHTML = outputContent;
            document.getElementById('promptContent').innerHTML = promptContent;
        }

        document.getElementById('outputContent').addEventListener('click', function() {
            window.getSelection().selectAllChildren(this);
        });

        document.getElementById('promptContent').addEventListener('click', function() {
            window.getSelection().selectAllChildren(this);
        });
    </script>
</body>
</html>