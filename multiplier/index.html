<!DOCTYPE html>
<html>
<head>
  <style>
    #app {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      width: 100%;
    }

    #app > div {
      display: flex;
      gap: 10px;
      width: 100%;
    }

    textarea {
      width: 32%;
      height: 300px;
    }

    .modifier-container {
      display: flex;
      flex-direction: column;
      width: 32%;
    }
    .modifier-container > textarea {
      width: 100%;
    }
    .modifier-container > input[type="text"] {
      width: 100%;
    }

    .textarea-container {
      position: relative;
    }

    .clear-button, .copy-button {
      position: absolute;
      top: 5px;
      right: 5px;
      background: none;
      border: none;
      cursor: pointer;
    }

  </style>
</head>
<body>
  <div id="app">
    <div class="textarea-container">
      <textarea id="keywords" placeholder="keywords"></textarea>
      <button class="clear-btn" onclick="clearTextArea()">üóëÔ∏è</button>
    </div>
      <div class="modifier-container">
        <input type="text" id="placeholder1" placeholder="placeholder 1">
        <textarea id="modifier1" placeholder="modifier 1"></textarea>
      </div>
      <div class="modifier-container">
        <input type="text" id="placeholder2" placeholder="placeholder 2">
        <textarea id="modifier2" placeholder="modifier 2"></textarea>
      </div>
    </div>
    <div>
      <input type="checkbox" id="addSpace"> Add Space
    </div>
    <div class="textarea-container modifier-container">
      <textarea id="results" placeholder="results" readonly></textarea>
      <button class="copy-btn" onclick="copyToClipboard()">üìã</button>
    </div>
    <button onclick="generate()">Generate</button>
    <input type="text" id="omegaApiKey" placeholder="Omega API Key">
    <input type="text" id="campaignName" placeholder="Campaign Name">
    <input type="number" id="dripfeed" placeholder="Dripfeed">
    <button onclick="sendToOmega()">Send to Omega</button>
  </div>

  <script>
// Add autosuggest in placeholder
document.getElementById('keywords').addEventListener('input', function(e) {
  const regex = /\[([^\]]+)\]/g;
  let match;
  let placeholders = [];
  while ((match = regex.exec(e.target.value)) != null) {
    placeholders.push(match[0]);
  }
  placeholders = [...new Set(placeholders)]; // remove duplicates
  document.getElementById('placeholder1').setAttribute('list', 'suggestions');
  document.getElementById('placeholder2').setAttribute('list', 'suggestions');
  let datalist = document.getElementById('suggestions');
  if (!datalist) {
    datalist = document.createElement('datalist');
    datalist.id = 'suggestions';
    document.body.appendChild(datalist);
  }
  datalist.innerHTML = '';
  placeholders.forEach(function(placeholder) {
    const option = document.createElement('option');
    option.value = placeholder;
    datalist.appendChild(option);
  });
});

// Force placeholder to be upper case
document.getElementById('placeholder1').addEventListener('input', function(e) {
  e.target.value = e.target.value.toUpperCase();
});

document.getElementById('placeholder2').addEventListener('input', function(e) {
  e.target.value = e.target.value.toUpperCase();
});

// Save data to local storage
window.onload = function() {
  document.getElementById('keywords').value = localStorage.getItem('keywords');
  document.getElementById('results').value = localStorage.getItem('results');
}

document.getElementById('keywords').addEventListener('input', function() {
  localStorage.setItem('keywords', this.value);
});

document.getElementById('results').addEventListener('input', function() {
  localStorage.setItem('results', this.value);
});

// Copy to clipboard
function copyToClipboard() {
  var copyText = document.getElementById("results");
  copyText.select();
  copyText.setSelectionRange(0, 99999);
  document.execCommand("copy");
}

// Clear text area
function clearTextArea() {
  document.getElementById('keywords').value = '';
  localStorage.removeItem('keywords');
}

    function generate() {
  var keywords = document.getElementById('keywords').value.split('\n');
  var modifier1 = document.getElementById('modifier1').value.split('\n');
  var modifier2 = document.getElementById('modifier2').value.split('\n');
  var placeholder1 = document.getElementById('placeholder1').value;
  var placeholder2 = document.getElementById('placeholder2').value;
  var addSpace = document.getElementById('addSpace').checked;
  var results = [];

  keywords.forEach(function(keyword) {
    var result = keyword;
    var placeholder1Exists = placeholder1 && keyword.includes(placeholder1);
    var placeholder2Exists = placeholder2 && keyword.includes(placeholder2);

    if (placeholder1Exists || placeholder2Exists) {
      modifier1.forEach(function(mod1) {
        if (placeholder1Exists) {
          result = result.replace(placeholder1, mod1);
        }
        modifier2.forEach(function(mod2) {
          if (placeholder2Exists) {
            result = result.replace(placeholder2, mod2);
          }
          results.push(result);
        });
      });
    } else {
      results.push(result);
    }
  });

  document.getElementById('results').value = results.join('\n');
}

    function sendToOmega() {
      var apiKey = document.getElementById('omegaApiKey').value;
      var campaignName = encodeURIComponent(document.getElementById('campaignName').value);
      var urls = encodeURIComponent(document.getElementById('results').value.split('\n').join('|'));
      var dripfeed = document.getElementById('dripfeed').value;

      var xhr = new XMLHttpRequest();
      xhr.open("POST", 'https://www.omegaindexer.com/amember/dashboard/api', true);
      xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      xhr.onreadystatechange = function() {
        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
          alert("Data sent to Omega Indexer successfully");
        }
      }
      xhr.send(`apikey=${apiKey}&campaignname=${campaignName}&dripfeed=${dripfeed}&urls=${urls}`);
    }

    document.getElementById('dripfeed').value = Math.ceil(document.getElementById('results').value.split('\n').length / 30);
  </script>
</body>
</html>
