<!DOCTYPE html>
<html>
<head>
    <title>Google Sheets Parser</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
    <style>
        textarea {
            width: 45%;
            height: 200px;
            float: left;
            margin-right: 10px;
        }
        #controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 90%;
            margin: 10px auto;
        }
        #outputColumn, #promptColumn, #showContent {
            width: 30%;
        }
    </style>
</head>
<body>
    <h1>Google Sheets Generator ver 1.04</h1>
    <input type="text" id="sheetUrl" placeholder="Public Google Sheet URL">
    <input type="text" id="sheetName" placeholder="Sheet Name">
    <button onclick="parseSheet()">Get</button>
    <p id="loading" style="display: none;">Loading...</p>
    <div id="controls" style="display: none;">
        <label for="outputColumn" id="outputLabel">Output Column:</label>
        <select id="outputColumn"></select>
        <label for="promptColumn" id="promptLabel">Prompt Column:</label>
        <select id="promptColumn"></select>
        <button id="showContent" onclick="showContent()">ðŸ‘€ Content</button>
    </div>
    <textarea id="outputContent" style="display: none;"></textarea>
    <textarea id="promptContent" style="display: none;"></textarea>

    <script>
        var lines = [];
        function parseSheet() {
            var url = document.getElementById('sheetUrl').value;
            var sheetName = document.getElementById('sheetName').value;
            var urlRegex = /^https:\/\/docs\.google\.com\/spreadsheets\/d\/(.+)\/edit#gid=(.+)$/;

            if (!urlRegex.test(url)) {
                alert('Invalid URL. The correct format is: https://docs.google.com/spreadsheets/d/{sheetId}/edit#gid={gid}');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            var sheetId = url.split('/')[5];
            var gid = url.split('gid=')[1];
            var sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${sheetName}`;

            $.get(sheetUrl, function(data) {
                var results = Papa.parse(data, {header: true});
                lines = results.data;
                var columnTitles = Object.keys(lines[0]);

                var outputSelect = document.getElementById('outputColumn');
                var promptSelect = document.getElementById('promptColumn');
                outputSelect.innerHTML = "";
                promptSelect.innerHTML = "";
                outputSelect.style.display = "block";
                promptSelect.style.display = "block";
                document.getElementById('outputLabel').style.display = "block";
                document.getElementById('promptLabel').style.display = "block";
                document.getElementById('showContent').style.display = "block";

                for(var j = 0; j < columnTitles.length; j++) {
                    var option1 = document.createElement('option');
                    var option2 = document.createElement('option');
                    option1.text = columnTitles[j];
                    option2.text = columnTitles[j];
                    outputSelect.add(option1);
                    promptSelect.add(option2);
                }
                document.getElementById('loading').style.display = 'none';
            }).fail(function() {
                alert('Failed to fetch data. Please check the URL and Sheet Name.');
                document.getElementById('loading').style.display = 'none';
            });
        }

        function showContent() {
            var outputIndex = document.getElementById('outputColumn').value;
            var promptIndex = document.getElementById('promptColumn').value;
            var outputContent = "";
            var promptContent = "";

            for(var i = 0; i < lines.length; i++) {
                outputContent += lines[i][outputIndex] + "\n";
                promptContent += lines[i][promptIndex] + "\n";
            }

            document.getElementById('outputContent').style.display = "block";
            document.getElementById('promptContent').style.display = "block";
            document.getElementById('outputContent').value = outputContent;
            document.getElementById('promptContent').value = promptContent;
        }
    </script>
</body>
</html>