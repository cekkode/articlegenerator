<!DOCTYPE html>
<html>
<head>
  <title>AI Model</title>
  <style>
    /* Style for chat-like interface */
    #chatContainer {
      display: flex;
      flex-direction: column;
    }
    #chatContainer textarea {
      width: 100%;
      margin-bottom: 10px;
      resize: none; /* Prevent resizing */
    }
    #chatContainer .contextCheckbox {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1 id="modelTitle">Google Gemini Model</h1>
  <form id="form">
    <input type="text" id="system" name="system" placeholder="You're a helpful AI coder which specializes in JavaScript">

    <select id="model" name="model">
      <option value="GEMINI" selected>GEMINI</option>
      <option value="CHATGPT">CHATGPT</option>
    </select>
    <span id="aiStatus">Ready to receive prompt</span>
    <div id="chatContainer">
      <textarea id="prompt" name="prompt" placeholder="Enter your prompt here"></textarea>
      <textarea id="response" name="response" placeholder="Response"></textarea>
      <input type="checkbox" class="contextCheckbox" checked> Include as context
    </div>
  
    <input type="submit" value="Submit">
  </form>

  <script>
    var version = " 0.1.12";
    // Adding version to the end of h1
    document.getElementById("modelTitle").innerText += version;

    // Function to generate response
    function generateResponse(prompt, model) {
      // Show "waiting response" message
      document.getElementById('aiStatus').innerText = 'Waiting for response from Gemini AI...';
      var responseTextareaId = 'response' + Date.now();
      var responseTextarea = createResponseTextarea(responseTextareaId);
      var contextCheckbox = createCheckbox(responseTextareaId);
      adjustTextareaHeight(responseTextarea);
      
      if (model === "GEMINI") {
        GEMINI(prompt, responseTextareaId);
      } else if (model === "CHATGPT") {
        document.getElementById('modelTitle').innerText = "OpenAI ChatGPT Model";
        // Add code to use OpenAI ChatGPT model
      }
    }

    // Submit form when Ctrl+Enter is pressed in prompt textarea
    document.getElementById("chatContainer").addEventListener("keydown", function(event) {
      if (event.ctrlKey && event.key === "Enter") {
        event.preventDefault();
        if (event.target.id === "prompt") {
          // Only submit the form when Ctrl + Enter is pressed in the prompt textarea
          var prompt = event.target.value;
          var model = document.getElementById('model').value;
          generateResponse(prompt, model);
        }
      }
    });

    // Submit form on submit button click
    document.getElementById("form").addEventListener("submit", function(event) {
      event.preventDefault();
      var prompt = document.getElementById('prompt').value;
      var model = document.getElementById('model').value;
      generateResponse(prompt, model);
    });

    function GEMINI(prompt, responseTextareaId) {
      var apiKey = "AIzaSyCf4gfFzHbnFqivbgZTNpK7pmnRIgjSxjk";
      var apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent";
      
      var headers = {
        "Content-Type": "application/json"
      };
      
      var requestBody = {
        "contents": [{
          "parts": [{
            "text": prompt
          }]}
        ]
      };

      // Collect context from checked response textareas
      var context = [];
      var contextCheckboxes = document.querySelectorAll('.contextCheckbox');
      contextCheckboxes.forEach(function(checkbox) {
        if (checkbox.checked) {
          var textareaId = checkbox.getAttribute('data-textarea-id');
          var textarea = document.getElementById(textareaId);
          if (textarea) {
            context.push(textarea.value);
          }
        }
      });
      
      // Append context to request body
      requestBody.contents[0].parts = requestBody.contents[0].parts.concat(context.map(function(content) {
        return {"text": content};
      }));
      
      var options = {
        "method": "POST",
        "headers": headers,
        "body": JSON.stringify(requestBody)
      };

      fetch(apiUrl + "?key=" + apiKey, options)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          console.log('API Response:', data);
          if (data && data.candidates && data.candidates.length > 0) {
            var output = data.candidates[0].content.parts[0].text;
            updateOrCreateResponseTextarea(responseTextareaId, output);
          } else {
            throw new Error('No candidates found in API response');
          }
        })
        .catch(error => {
          handleResponseError(responseTextareaId, error);
        })
        .finally(() => {
          document.getElementById('aiStatus').innerText = 'Ready to receive prompt';
          addNewPromptAndResponseTextarea();
        });
    }
    
    // Function to update or create response textarea
    function updateOrCreateResponseTextarea(responseTextareaId, content) {
      var responseTextarea = document.getElementById(responseTextareaId);
      if (!responseTextarea) {
        responseTextarea = createResponseTextarea(responseTextareaId);
        document.getElementById('chatContainer').appendChild(responseTextarea);
      }
      responseTextarea.value = content;
      adjustTextareaHeight(responseTextarea);
    }    

    // Function to handle response errors
    function handleResponseError(responseTextareaId, error) {
      var responseTextarea = document.getElementById(responseTextareaId);
      if (!responseTextarea) {
        responseTextarea = createResponseTextarea(responseTextareaId);
        document.getElementById('chatContainer').appendChild(responseTextarea);
      }
      responseTextarea.value = 'Error: ' + error.message;
      adjustTextareaHeight(responseTextarea);
    }

    // Function to create a new response textarea with a unique ID
    function createResponseTextarea(responseTextareaId) {
      var responseTextarea = document.createElement('textarea');
      responseTextarea.setAttribute('id', responseTextareaId);
      responseTextarea.setAttribute('name', 'response');
      responseTextarea.setAttribute('placeholder', 'Response');
      return responseTextarea;
    }

    // Function to create a checkbox for context inclusion
    function createCheckbox(responseTextareaId) {
      var checkbox = document.createElement('input');
      checkbox.setAttribute('type', 'checkbox');
      checkbox.setAttribute('class', 'contextCheckbox');
      checkbox.setAttribute('checked', 'true');
      checkbox.setAttribute('data-textarea-id', responseTextareaId);
      document.getElementById('chatContainer').appendChild(checkbox);
      return checkbox;
    }

    // Function to adjust textarea height based on content
    function adjustTextareaHeight(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = (textarea.scrollHeight) + 'px';
    }

    // Function to add new prompt and response textarea below the response
    function addNewPromptAndResponseTextarea() {
      var chatContainer = document.getElementById('chatContainer');
      
      // Remove existing response textarea if any
      var existingResponseTextarea = document.getElementById('response');
      if (existingResponseTextarea) {
        chatContainer.removeChild(existingResponseTextarea);
      }

      // Remove existing context checkbox if any
      var existingContextCheckbox = document.querySelector('.contextCheckbox');
      if (existingContextCheckbox) {
        chatContainer.removeChild(existingContextCheckbox);
      }

      // Create new prompt textarea
      var newPromptTextarea = document.createElement('textarea');
      newPromptTextarea.setAttribute('id', 'prompt');
      newPromptTextarea.setAttribute('name', 'prompt');
      newPromptTextarea.setAttribute('placeholder', 'Enter your prompt here');
      chatContainer.appendChild(newPromptTextarea);

      // Focus on the new prompt textarea
      newPromptTextarea.focus();
    }
  </script>
</body>
</html>
